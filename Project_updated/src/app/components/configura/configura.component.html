<app-header [my-title]="'Configura'"> </app-header>

<!-- **************** -->
<!-- RIEPILOGO STORIA -->
<!-- **************** -->
<mat-card *ngIf="storia" class="riepilogo-attivita">
  <mat-card-header>
    <div *ngIf="flagSalvataggio == true" class="salva-button">
      <button color="primary" mat-raised-button (click)="onSaveStory()">
        Salva storia
      </button>
    </div>
    <mat-card-title
      ><h1 style="font-weight: bold">{{ storia.nome }}</h1>
    </mat-card-title>
    <mat-card-subtitle
      ><div class="img-responsive">
        <img
          [src]="storia.urlBackground"
          [alt]="'  immagine sfondo di  ' + storia.nome"
        /></div
    ></mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <div *ngFor="let act of storia.steps; index as j">
      <div class="header">
        <!-- row 1 -->
        <div class="header-title">
          <p style="font-weight: bold">
            #{{ j }} Attività n.{{ act.activityId }}
          </p>
          <p>Tipologia: ({{ act.action }})</p>
        </div>
        <div class="button-container">
          <div class="button-edit-container">
            <button (click)="editAttivita(act)" mat-mini-fab color="primary">
              <i class="material-icons">edit</i>
            </button>
          </div>
          <div class="button-edit-container">
            <button (click)="eliminaAttivita(j)" mat-mini-fab color="warn">
              <i class="material-icons">delete</i>
            </button>
          </div>
        </div>
      </div>

      <!-- end row 1 -->
      <!-- row 2 -->

      <h3 style="font-weight: bold">Contenuto:</h3>
      <p>{{ act.activityTitle }}</p>

      <!-- end row 2 -->
      <!-- eventual row 3 -->
      <div *ngIf="act.action == 'domanda'">
        <h3 style="font-weight: bold">Risposta:</h3>
        <p>{{ act.risposteDomanda }}</p>
      </div>
      <!-- row 4 -->
      <div class="risposte-quiz" *ngIf="act.action == 'quiz'">
        <h3 style="font-weight: bold">Id Risposta:</h3>
        <p>{{ act.quizCorrectIdx }}</p>

        <h3 style="font-weight: bold">Id errato:</h3>
        <p>{{ act.wrongId }}</p>

        <h3 style="font-weight: bold">Id corretto:</h3>
        <p>{{ act.correctId }}</p>
      </div>

      <p *ngIf="!storia.steps || storia.steps.length == 0">
        Nessuna attività presente
      </p>
    </div>
  </mat-card-content>
</mat-card>

<!-- ****************** -->
<!-- CREAZIONE ATTIVITA -->
<!-- ****************** -->
<mat-card *ngIf="storia" class="crea-attivita">
  <mat-card-title>Aggiungi attività alla tua storia</mat-card-title>
  <form [formGroup]="form" class="example-form">
    <!-- TIPOLOGIA -->

    <mat-form-field class="example-full-width">
      <mat-label>Tipologia Attività</mat-label>
      <mat-select matNativeControl [(value)]="tempTipologiaAttivita" required>
        <mat-option value="informazione">Testo a caso Informativo</mat-option>
        <mat-option value="domanda">Domanda</mat-option>
        <mat-option value="quiz">Quiz</mat-option>
        <mat-option value="puzzle">Puzzle</mat-option>
        <mat-option value="dnd">Drag&Drop</mat-option>
        <mat-option value="fine">Fine</mat-option>
      </mat-select>
      <mat-error *ngIf="form.get('tempTipologiaAttivita').invalid"
        >Per favore inserisci tipologia</mat-error
      >
    </mat-form-field>

    <!-- TIPOLOGIA : QUIZ | Numero Risposte -->
    <mat-form-field
      *ngIf="tempTipologiaAttivita == 'quiz'"
      class="example-full-width"
    >
      <mat-label>Numero Risposte</mat-label>
      <mat-select
        matNativeControl
        (selectionChange)="aggiornaRisposteQuiz()"
        [(value)]="numeroRisposte"
      >
        <mat-option value="2">2</mat-option>
        <mat-option value="3">3</mat-option>
        <mat-option value="4">4</mat-option>
      </mat-select>

      <mat-error *ngIf="form.get('numeroRisposte').invalid"
        >Inserisci un numero</mat-error
      >
    </mat-form-field>

    <!-- CONTENUTO PER QUALSIASI TIPOLOGIA -->
    <mat-form-field
      *ngIf="tempTipologiaAttivita != ''"
      class="example-full-width"
    >
      <mat-label>
        {{ getTitleTranslation(tempTipologiaAttivita) | titlecase }}</mat-label
      >
      <textarea
        matInput
        type="text"
        formControlName="tempContenuto"
        [(ngModel)]="tempContenuto"
        [placeholder]="
          'Inserisci ' + getTitleTranslation(tempTipologiaAttivita)
        "
      ></textarea>
    </mat-form-field>

    <!-- TIPOLOGIA : DOMANDA | Risposta Corretta-->
    <section *ngIf="tempTipologiaAttivita == 'domanda'">
      <mat-label>Risposta</mat-label>
      <div class="difficulty-levels">
        <div class="input-group">
          <input
            type="radio"
            [(ngModel)]="tempTipoDomanda"
            name="tipoDomanda"
            id="right"
            value="right"
            checked
            [ngModelOptions]="{ standalone: true }"
          /><label for="right"> right </label>
        </div>
        <div class="input-group">
          <input
            type="radio"
            [(ngModel)]="tempTipoDomanda"
            name="tipoDomanda"
            id="array"
            value="array"
            [ngModelOptions]="{ standalone: true }"
          /><label for="array"> array </label>
        </div>
      </div>
      <div *ngIf="tempTipoDomanda == 'array'" class="example-full-width">
        <button
          (click)="aggiornaTempRisposta()"
          mat-stroked-button
          color="link"
        >
          Aggiungi elemento
        </button>
        {{ tempRisposteDomanda }}
        <div
          *ngFor="
            let item of tempRisposteDomanda;
            let i = index;
            trackBy: trackByFn
          "
        >
          <div class="dnd-table">
            <input
              [(ngModel)]="tempRisposteDomanda[i]"
              [ngModelOptions]="{ standalone: true }"
            />
          </div>
        </div>
      </div>
    </section>

    <!-- TIPOLOGIA Drag&Drop -->
    <div *ngIf="tempTipologiaAttivita == 'dnd'" class="example-full-width">
      <mat-label>Inserisci gli elementi da ordinare</mat-label>
      <button (click)="aggiornaOrder()" mat-stroked-button color="link">
        Aggiungi elemento
      </button>

      <div *ngFor="let item of tempOrder; let i = index; trackBy: trackByFn">
        <div class="dnd-table">
          <input
            [(ngModel)]="tempOrder[i].desc"
            [ngModelOptions]="{ standalone: true }"
          />
          <input
            [(ngModel)]="tempOrder[i].posizione"
            [ngModelOptions]="{ standalone: true }"
          />
        </div>
      </div>
    </div>

    <!-- TIPOLOGIA : QUIZ | Array Risposte -->
    <div *ngIf="tempTipologiaAttivita == 'quiz'">
      <mat-radio-group
        [(ngModel)]="tempQuizCorrectIdx"
        [ngModelOptions]="{ standalone: true }"
        ngmodelaria-label="Select an option"
      >
        <div>
          <mat-label>Inserisci le risposte e indica quella corretta</mat-label>
          <div
            *ngFor="let item of risposteQuiz; let i = index; trackBy: trackByFn"
          >
            <div class="input-group">
              <mat-radio-button [value]="i"> </mat-radio-button>
              <input
                style="background-color: transparent"
                [(ngModel)]="risposteQuiz[i]"
                [ngModelOptions]="{ standalone: true }"
              />
            </div>
          </div>
        </div>
      </mat-radio-group>
    </div>

    <!-- TIPOLOGIA : PUZZLE -->
    <section *ngIf="tempTipologiaAttivita == 'puzzle'">
      <h3>Immagine per il puzzle</h3>

      <!-- Risorsa Web o Locale -->
      <div class="img-puzzle">
        <div class="difficulty-levels">
          <div class="input-group">
            <input
              type="radio"
              [(ngModel)]="tempTipoUpload"
              name="upload"
              value="web"
              id="web"
              checked
              [ngModelOptions]="{ standalone: true }"
            /><label for="web">Risorsa Web</label>
          </div>
          <div class="input-group">
            <input
              type="radio"
              [(ngModel)]="tempTipoUpload"
              name="upload"
              value="locale"
              id="locale"
              [ngModelOptions]="{ standalone: true }"
            /><label for="locale">File Locale</label>
          </div>
        </div>

        <!-- Se seleziono risorsa web-->
        <div class="image-url" *ngIf="tempTipoUpload == 'web'">
          <span class="input-group-btn">
            <div class="btn btn-default"><h3>Image Url!</h3></div>
          </span>
          <div class="input-group">
            <input
              type="url"
              class="form-control"
              placeholder="Image Url..."
              [(ngModel)]="tempImgPuzzle"
              [ngModelOptions]="{ standalone: true }"
            />
          </div>
        </div>
        <!-- se seleziono file locale-->
        <div class="image-url" *ngIf="tempTipoUpload == 'locale'">
          <div class="button-pick-puzzle">
            <span class="input-group-btn">
              <div class="btn btn-default">
                <h3>Carica la tua immagine:</h3>
              </div>
            </span>
            <button
              mat-stroked-button
              type="button"
              color="link"
              (click)="puzzlePicker.click()"
            >
              Pick Image
            </button>
            <input
              type="file"
              #puzzlePicker
              (change)="onImagePicked($event, 'puzzle')"
            />

            <div
              class="puzzle-preview"
              *ngIf="tempImgPuzzle !== '' && tempImgPuzzle"
            >
              <img [src]="tempImgPuzzle" alt="puzzleImg" />
            </div>
          </div>
        </div>
      </div>
      <!-- Difficolta -->
      <div class="difficolta">
        <h3>Difficulty Level</h3>
        <div class="difficulty-levels">
          <div class="input-group">
            <input
              type="radio"
              [(ngModel)]="tempDifficulty"
              name="difficulty"
              id="low"
              value="2"
              checked
              [ngModelOptions]="{ standalone: true }"
            /><label for="low"> Low </label>
          </div>
          <div class="input-group">
            <input
              type="radio"
              [(ngModel)]="tempDifficulty"
              name="difficulty"
              id="medium"
              value="3"
              [ngModelOptions]="{ standalone: true }"
            /><label for="medium"> Medium </label>
          </div>
          <div class="input-group">
            <input
              type="radio"
              [(ngModel)]="tempDifficulty"
              name="difficulty"
              id="high"
              value="4"
              [ngModelOptions]="{ standalone: true }"
            /><label for="high"> High </label>
          </div>
        </div>
      </div>
    </section>

    <!-- Scelta attività successiva in caso di risposta corretta/errata -->
    <section *ngIf="tempTipologiaAttivita != 'fine'">
      <mat-form-field class="example-full-width">
        <mat-label>Corretto</mat-label>
        <mat-select
          [(ngModel)]="tempCorrect"
          formControlName="tempCorrect"
          [(value)]="tempCorrect"
          panelClass="correct"
        >
          <mat-option *ngFor="let act of storia.steps" [value]="act.activityId">
            {{ act.activityId }} : {{ act.activityTitle }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('tempCorrect').invalid"
          >Per favore inserisci id coretto</mat-error
        >
      </mat-form-field>

      <mat-form-field class="example-full-width">
        <mat-label>Sbagliato</mat-label>
        <mat-select
          [(ngModel)]="tempWrong"
          formControlName="tempWrong"
          [(value)]="tempWrong"
          panelClass="wrong"
        >
          <mat-option *ngFor="let act of storia.steps" [value]="act.activityId">
            {{ act.activityId }} : {{ act.activityTitle }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="form.get('tempWrong').invalid"
          >Per favore inserisci id errato</mat-error
        >
      </mat-form-field>
    </section>

    <!-- Associazione immagine ad attività -->
    <mat-form-field class="example-full-width">
      <mat-label>Nome immagine</mat-label>
      <input matInput placeholder="Inserisci qui il nome dell'immagine" />
    </mat-form-field>
    <mat-form-field class="example-full-width">
      <mat-label>Alt immagine</mat-label>
      <input
        matInput
        placeholder="Inserisci qui il testo alternativo per il'immagine"
      />
    </mat-form-field>
    <div>
      <button
        mat-stroked-button
        class="button-pick"
        type="button"
        color="link"
        (click)="filePicker.click()"
      >
        Pick Image
      </button>
      <input type="file" #filePicker (change)="onImagePicked($event)" />
    </div>
    <div style="width: 100%">
      <input
        type="url"
        class="form-control"
        placeholder="Image Url..."
        style="font-size: 0.8em"
        [(ngModel)]="imagePreview"
        [ngModelOptions]="{ standalone: true }"
      />
    </div>
    <div
      class="image-preview"
      *ngIf="imagePreview !== '' && imagePreview && form.get('image').valid"
    >
      <img [src]="imagePreview" [alt]="form.value.title" />
    </div>
    <div>
      <button
        *ngIf="this.tempActivityId == -1"
        mat-raised-button
        class="aggAttivita"
        color="primary"
        (click)="aggiungiAttivita(tempTipologiaAttivita)"
      >
        Aggiungi Attività
      </button>
    </div>
    <div class="container-button">
      <button
        mat-raised-button
        color="primary"
        class="aggAttivita"
        (click)="onSaveActivity()"
        *ngIf="this.tempActivityId != -1"
      >
        Salva modifiche
      </button>

      <button
        mat-raised-button
        color="warn"
        (click)="tempActivityId = -1; this.form.reset()"
        *ngIf="this.tempActivityId != -1"
      >
        ESCI
      </button>
    </div>
  </form>
</mat-card>
