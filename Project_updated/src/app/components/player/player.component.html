<ngb-alert
  *ngFor="let alert of alerts"
  [type]="alert.type"
  (close)="close(alert)"
  >{{ alert.message }}
</ngb-alert>

<section *ngIf="!playClicked" class="mainSection" id="sec">
  <section id="tipoS">
    <h2>Seleziona la storia che preferisci e inizia a giocare</h2>
    <div class="tipoStoria">
      <div class="card">
        <input
          type="radio"
          name="tipologiaGruppo"
          id="Individuale"
          value="individuale"
          [(ngModel)]="tipologiaGruppo"
        />
        <label class="fa fa-code" for="Individuale">
          <i class="material-icons" aria-hidden="false" aria-label="person icon"
            >person</i
          >
          <br />
          <p>Individuale</p>
        </label>
      </div>

      <div class="card">
        <input
          type="radio"
          name="tipologiaGruppo"
          id="Gruppo"
          value="gruppo"
          [(ngModel)]="tipologiaGruppo"
          (click)="popolaDimensioni('gruppo')"
        />
        <label class="fa fa-code" for="Gruppo">
          <i class="material-icons" aria-hidden="false" aria-label="group icon"
            >group</i
          >
          <br />
          <p>Gruppo</p>
          <p>(2-5 persone)</p>
        </label>
      </div>

      <div class="card">
        <input
          type="radio"
          name="tipologiaGruppo"
          id="Classe"
          value="classe"
          [(ngModel)]="tipologiaGruppo"
          (click)="popolaDimensioni('classe')"
        />
        <label class="fa fa-code" for="Classe">
          <i class="material-icons" aria-hidden="false" aria-label="person icon"
            >groups</i
          >
          <br />
          <div class="text">
            <p>Classe</p>
            <p>(15-25 persone)</p>
          </div>
        </label>
      </div>
    </div>
  </section>
  <div class="container2">
    <mat-form-field
      appearance="fill"
      *ngIf="tipologiaGruppo == 'classe' || tipologiaGruppo == 'gruppo'"
      ngDefaultControl
      name="nPartecipanti"
    >
      <mat-label>Numero di studenti</mat-label>
      <mat-select
        [(ngModel)]="nPartecipanti"
        (ngModelChange)="nPartecipantiChanged()"
      >
        <mat-option *ngFor="let dimensione of dimensioni" [value]="dimensione">
          {{ dimensione }} studenti
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <section id="sec2" *ngIf="nPartecipanti != -1 && tipologiaGruppo == 'classe'">
    <p>Partecipanti : {{ nPartecipantiAggiunti }} / {{ nPartecipanti }}</p>

    <button
      *ngIf="nPartecipanti - nPartecipantiAggiunti >= 2"
      (click)="aggiungiNuovaSquadra()"
      mat-raised-button
      color="basic"
    >
      <p>+ Aggiungi squadra</p>
    </button>

    <div class="container3">
      <div class="card" *ngFor="let squadra of squadre">
        <div class="heading">
          <div class="nomeS-container">
            <p id="nomeSquadra">{{ squadra.name }}</p>
          </div>
          <div class="button-container">
            <button
              mat-mini-fab
              color="warn"
              *ngIf="this.squadre.length > this.nSquadre"
              (click)="eliminaSquadra(squadra.id)"
            >
              <i class="material-icons">clear</i>
            </button>
          </div>
        </div>
        <div class="content">
          <h4>Giocatori:</h4>
          <ul>
            <li *ngFor="let player of squadra.players">
              <p>{{ player }}</p>
            </li>
          </ul>
        </div>
        <div class="button-add-container">
          <button
            *ngIf="
              this.nPartecipantiAggiunti < this.nPartecipanti ||
              squadra.players.length < 5
            "
            mat-mini-fab
            color="primary"
            (click)="aggiungiPlayer(squadra.id)"
          >
            <i class="material-icons">add</i>
          </button>
        </div>
        <div class="button-rem-container">
          <button
            *ngIf="squadra.players.length > 2"
            mat-mini-fab
            color="warn"
            (click)="rimuoviPlayer(squadra.id)"
          >
            <i class="material-icons">delete_forever</i>
          </button>
        </div>
      </div>
    </div>
  </section>
  <!-- fine sec2 -->

  <section id="sec3">
    <div
      class="container4"
      aria-label="Select an option"
      (click)="traccia = -1"
    >
      <div class="card">
        <input
          type="radio"
          name="fasciaEta"
          id="7-10"
          value="fasciaUno"
          [(ngModel)]="fasciaEta"
        />
        <label for="7-10">
          <p>7 - 10 anni</p>
        </label>
      </div>

      <div class="card">
        <input
          type="radio"
          name="fasciaEta"
          id="11-14"
          value="fasciaDue"
          [(ngModel)]="fasciaEta"
        />
        <label for="11-14">
          <p>11 - 14 anni</p>
        </label>
      </div>

      <div class="card">
        <input
          type="radio"
          name="fasciaEta"
          id="15-18"
          value="fasciaTre"
          [(ngModel)]="fasciaEta"
        />
        <label for="15-18">
          <p>15 - 18 anni</p>
        </label>
      </div>
    </div>

    <div class="container5" *ngIf="fasciaEta != ''">
      <form aria-label="Select an option" *ngFor="let storia of storie">
        <div class="card" *ngIf="storia.fasciaEta == fasciaEta">
          <input
            [id]="storia.id"
            name="traccia"
            type="radio"
            [value]="storia.id"
            [(ngModel)]="traccia"
          />
          <label [for]="storia.id">
            <i class="material-icons">history_edu</i>
            <br />
            <p>{{ storia.title }}</p>
            <img [src]="storia.urlBackground" />
          </label>
        </div>
      </form>
    </div>
  </section>

  <hr />
  <div class="container6">
    <div class="container-riepilogo">
      <p class="title">Riepilogo</p>
    </div>
    <div class="container-riepilogo">
      <p>Gruppo : {{ tipologiaGruppo }}</p>
    </div>
    <div class="container-riepilogo">
      <p>Fascia di et√† : {{ fasciaEta }}</p>
    </div>
    <div *ngIf="traccia != -1">
    <div class="container-riepilogo" >
      <p>Traccia: {{ traccia }}</p>
    </div>
      <div class="container-riepilogo" >
      <qrcode
        *ngIf="tipologiaGruppo == 'individuale' || tipologiaGruppo == 'gruppo'"
        [qrdata]="
          'http://localhost:4200/player/' +
          tipologiaGruppo +
          '/' +
          fasciaEta +
          '/' +
          traccia +
          '/autoplay'
        "
        [width]="256"
        [errorCorrectionLevel]="'M'"
      ></qrcode>
    </div>
      <div class="container-riepilogo">
      <button
        *ngIf="tipologiaGruppo == 'individuale'"
        mat-raised-button
        color="primary"
        (click)="iniziaPartita(this.traccia)"
      >
        <p>Inizia Partita</p>
        <br />
      </button>
    </div>
    </div>
  </div>

<div class="container-riepilogo">
  <div
    *ngIf="
      tipologiaGruppo != 'individuale' &&
      tipologiaGruppo != '' &&
      nPartecipantiAggiunti == nPartecipanti
    "
    class="fixedLowRight"
    (click)="playClick()"
  >
    <button mat-fab color="warn" class="my-fab-button">
      <mat-icon class="icon-tipoS">play_arrow</mat-icon>
    </button>
  </div>
</div>
</section>
<!-- fine MainSection -->

<section *ngIf="playClicked">
  <div *ngIf="tipologiaGruppo == 'individuale'">
    <p>Ecco il tuo QR code!</p>
    <qrcode
      [qrdata]="
        'http://localhost:4200/player/' +
        tipologiaGruppo +
        '/' +
        fasciaEta +
        '/' +
        traccia +
        '/autoplay'
      "
      [width]="256"
      [errorCorrectionLevel]="'M'"
    ></qrcode>
    <button
      mat-raised-button
      color="primary"
      (click)="iniziaPartita(this.traccia)"
    >
      <p>Inizia Partita</p>

    </button>
  </div>

  <div *ngIf="tipologiaGruppo == 'classe' || tipologiaGruppo == 'gruppo'">
    <p>Ecco i vostri QR Code!</p>
    <mat-card *ngFor="let s of squadre" class="example-card">
      <mat-card-header>
        <mat-card-title>{{ s.name }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <qrcode
          [qrdata]="
            'http://localhost:4200/player/' +
            tipologiaGruppo +
            '/' +
            fasciaEta +
            '/' +
            traccia +
            '/autoplay/' +
            s.idPartita
          "
          [width]="256"
          [errorCorrectionLevel]="'M'"
        ></qrcode>
      </mat-card-content>
    </mat-card>
  </div>
</section>

