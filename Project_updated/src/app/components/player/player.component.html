<ngb-alert
  *ngFor="let alert of alerts"
  [type]="alert.type"
  (close)="close(alert)"
  >{{ alert.message }}</ngb-alert
>

<section *ngIf="!playClicked" class="mainSection" id="sec">
  <h2>Seleziona la storia che preferisci e inizia a giocare</h2>

    <mat-grid-list
      cols="9"
      rowHeight="20vw">

        <mat-grid-tile
        colspan="3"
        rowspan="1">
          <input type="radio" name="tipologiaGruppo" id="Individuale" value="individuale" [(ngModel)]="tipologiaGruppo">
          <label class="fa fa-code"  for="Individuale">
              <mat-icon aria-hidden="false" aria-label="person icon">person</mat-icon> <br>
          <h3>Individuale</h3>
          </label>
        </mat-grid-tile>

        <mat-grid-tile
        colspan="3"
        rowspan="1">
          <input type="radio" name="tipologiaGruppo" id="Gruppo" value="gruppo" [(ngModel)]="tipologiaGruppo">
          <label class="fa fa-code"  for="Gruppo">
              <mat-icon aria-hidden="false" aria-label="group icon">group</mat-icon> <br>
          <h3>Gruppo </h3><h5>(2-5 persone)</h5>
          </label>
        </mat-grid-tile>

        <mat-grid-tile
        colspan="3"
        rowspan="1">
          <input type="radio" name="tipologiaGruppo" id="Classe" value="classe" [(ngModel)]="tipologiaGruppo">
          <label class="fa fa-code"  for="Classe">
              <mat-icon aria-hidden="false" aria-label="person icon">groups</mat-icon> <br>
          <h3>Classe</h3><h5>(15-25 persone)</h5>
          </label>
        </mat-grid-tile>
    </mat-grid-list>


  <div class="container2">
    <mat-form-field
      appearance="fill"
      *ngIf="tipologiaGruppo == 'classe'"
      ngDefaultControl
      name="nPartecipanti"
    >
      <mat-label>Numero di studenti</mat-label>
      <mat-select
        [(ngModel)]="nPartecipanti"
        (ngModelChange)="nPartecipantiChanged()"
      >
        <mat-option *ngFor="let dimensione of dimensioni" [value]="dimensione">
          {{ dimensione }} studenti
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <section id="sec2" *ngIf="nPartecipanti != -1 && tipologiaGruppo=='classe'" >
    <h3>Partecipanti : {{ nPartecipantiAggiunti }} / {{ nPartecipanti }}</h3>

      <button class="btn-aggsq"
      *ngIf="(nPartecipanti-nPartecipantiAggiunti>=2)" (click) = "aggiungiNuovaSquadra()"
        mat-flat-button>
        <h3>+ Aggiungi squadra</h3>
        </button>

      <div class="container3"  >
        <div class="card" *ngFor="let squadra of squadre">
          <div class="heading" >
            <div >
            <h1>{{ squadra.name }}</h1>
          </div>
            <div>
            <button  mat-mini-fab color="warn"
            *ngIf="this.squadre.length>this.nSquadre"
              (click)="eliminaSquadra(squadra.id)">
              <span class="material-icons" >clear</span>
            </button>
          </div>
          </div>
          <div class="content">
            <h3>Giocatori: </h3>
              <p *ngFor="let player of squadra.players">
                {{ player }}
              </p>
          </div>
          <button class="btn-add" *ngIf="this.nPartecipantiAggiunti<this.nPartecipanti"
              mat-stroked-button
              color="primary"
              (click)="aggiungiPlayer(squadra.id)">
             + Add
            </button>
            <button *ngIf="squadra.players.length>2"
              mat-stroked-button
              color="warn"
              (click)="rimuoviPlayer(squadra.id)">
              - Remove
            </button>
        </div>
      </div>
    </div>
  </section>
  <!-- fine sec2 -->

  <section id="sec3">
    <div class="container4">
      <form aria-label="Select an option" (click)="traccia = -1">
        <div class="card">
          <input
            type="radio"
            name="fasciaEta"
            id="7-10"
            value="fasciaUno"
            [(ngModel)]="fasciaEta"
          />
          <label class="" for="7-10">
            <h5>7 - 10 anni</h5>
          </label>
        </div>

        <div class="card">
          <input
            type="radio"
            name="fasciaEta"
            id="11-14"
            value="fasciaDue"
            [(ngModel)]="fasciaEta"
          />
          <label class="" for="11-14">
            <h5>11 - 14 anni</h5>
          </label>
        </div>

        <div class="card">
          <input
            type="radio"
            name="fasciaEta"
            id="15-18"
            value="fasciaTre"
            [(ngModel)]="fasciaEta"
          />
          <label class="" for="15-18">
            <h5>15 - 18 anni</h5>
          </label>
        </div>
      </form>
    </div>

    <div class="container5" *ngIf="fasciaEta != ''">
      <form aria-label="Select an option" *ngFor="let storia of storie">
        <div class="card">
          <input
            [id]="storia.id"
            name="traccia"
            type="radio"
            [value]="storia.id"
            *ngIf="storia.fasciaEta == fasciaEta"
            [(ngModel)]="traccia"
          />
          <label [for]="storia.id">
            <h4>{{ storia.title }}</h4>
            <img [src]="storia.urlBackground" />
          </label>
        </div>
      </form>
    </div>
  </section>
  <hr />
  <div class="container6">
    <mat-card>
      <mat-card-title> Riepilogo </mat-card-title>
      <mat-card-content>
        <h4>Gruppo : {{ tipologiaGruppo }}</h4>
        <h4>Fascia di et√† : {{ fasciaEta }}</h4>
        <br />
        <span *ngIf="traccia != -1">
          <h4>Traccia: {{ traccia }}</h4>
          <br />
          <qrcode
            *ngIf="
              tipologiaGruppo == 'individuale' || tipologiaGruppo == 'gruppo'
            "
            [qrdata]="
              'http://localhost:4200/player/' +
              tipologiaGruppo +
              '/' +
              fasciaEta +
              '/' +
              traccia +
              '/autoplay'
            "
            [width]="256"
            [errorCorrectionLevel]="'M'"
          ></qrcode>
          <button
            mat-raised-button
            color="success"
            (click)="iniziaPartita(this.traccia)"
          >
            Inizia Partita
          </button>
        </span>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="fixedLowRight" (click)="playClick()">
    <button mat-fab color="warn" class="my-fab-button">
      <mat-icon>play_arrow</mat-icon>
    </button>
  </div>
</section>
<!-- fine MainSection -->

<section *ngIf="playClicked">
  <div *ngIf="tipologiaGruppo == 'individuale'">
    <h3>Ecco il tuo QR code!</h3>
    <qrcode
      [qrdata]="'http://localhost:4200/lobby/786'"
      [width]="256"
      [errorCorrectionLevel]="'M'"
    ></qrcode>
    <button
      mat-raised-button
      color="info"
      (click)="iniziaPartita(this.traccia)"
    >
      Inizia Parita
    </button>
  </div>
  <div *ngIf="tipologiaGruppo == 'gruppo'">
    <h3>Ecco il vostro QR code!</h3>
    <qrcode
      [qrdata]="'http://localhost:4200/lobby/786'"
      [width]="256"
      [errorCorrectionLevel]="'M'"
    ></qrcode>
    <button
      mat-raised-button
      color="info"
      (click)="iniziaPartita(this.traccia)"
    >
      Inizia Parita
    </button>
  </div>

  <div *ngIf="tipologiaGruppo == 'classe'">
    <h3>Ecco i vostri QR Code!</h3>
    <mat-card *ngFor="let s of squadre" class="example-card">
      <mat-card-header>
        <mat-card-title>{{ s.name }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <qrcode
          [qrdata]="
            'http://localhost:4200/player/' +
            tipologiaGruppo +
            '/' +
            fasciaEta +
            '/' +
            traccia +
            '/autoplay/' +
            s.idPartita
          "
          [width]="256"
          [errorCorrectionLevel]="'M'"
        ></qrcode>
      </mat-card-content>
    </mat-card>
  </div>
</section>
<!--</div>-->
