<app-header [my-title]="'Visualizza'"> </app-header>

<button (click)="refresh()">aggiorna</button>
<section id="mainSection" *ngIf="this.storia">

  <mat-grid-list id="copertina" cols="3"  rowHeight="15vw"
  [ngStyle]="{'background-image': 'url(/assets/book.png)','background-size' : 'contain','background-repeat' : 'no-repeat'}"
  *ngIf="this.currentStepId < 0" >
    <mat-grid-tile
    colspan="3"
    rowspan="2" >
    <p class="storyTitle">{{this.storia.nome}}</p>
    </mat-grid-tile>
    <mat-grid-tile
        colspan="3"
        rowspan="1">
        <img class="imgCopertina" [src]="(this.storia.urlBackground)">
    </mat-grid-tile>
    <mat-grid-tile
    colspan="3"
    rowspan="1" >
    <button
    *ngIf="this.currentStepId < 0"
    mat-raised-button
    color="primary"
    (click)="iniziaStep()">
    <p>{{ startText ? startText : "Inizia"}}</p>
    <p>{{timestampGlobale}}</p>
    <p> Timestamp start : {{ this.stepStartAt }}</p>
  </button>
    </mat-grid-tile>
  </mat-grid-list>

  <mat-grid-list cols="4" rowHeight="25vw">
    <mat-grid-tile
        colspan="1"
        rowspan="1"
        style="background-color: green;">
        {{variabileOk }}
    </mat-grid-tile>
    <mat-grid-tile
        colspan="1"
        rowspan="1"
        style="background-color: rgb(92, 0, 128);">
        {{variabileOk }}
    </mat-grid-tile>
  </mat-grid-list>

    <h1>
      {{ title }}
    </h1>
    <h2>
      {{ didascalia }}
    </h2>

  <section *ngIf="this.storia.steps">
    <div *ngIf="this.currentStepId != -1">
      <!-- {{ this.steps[currentStepId]. }} -->

      <div *ngIf="this.storia.steps[currentStepId].action == 'quiz'">
        Ecco la domanda a cui rispondere :
        <b> {{ this.storia.steps[currentStepId].activityTitle }}</b>
        <ng-container
          *ngIf="
            this.storia.steps[currentStepId].answers &&
            this.storia.steps[currentStepId].answers.length > 0 ">
          <!-- <mat-selection-list #answers>
        <mat-list-option *ngFor="let answ of this.steps[currentStepId].answers">
          {{ answ.content }} {{ answ.correct }}
        </mat-list-option>
      </mat-selection-list> -->

          <mat-list
            role="list"
            *ngFor="
              let answ of this.storia.steps[currentStepId].answers;
              let i = index"
            (click)="gestisciAvanzamento(i)"
          >
            <button mat-raised-button color="accent" role="listitem">
              {{ answ }}
            </button>
          </mat-list>

          <!-- <p  style="padding-left: 20px;" *ngFor="let answ of this.steps[currentStepId].answers">
          <button
            mat-raised-button
            color="primary"
          >
            {{ answ.content }} {{ answ.correct }}
          </button>
        </p> -->
        </ng-container>
      </div> <!-- end QUIZ -->

      <div class="container1">
        <img *ngIf="this.storia.steps[this.currentStepId].backImg!=''"
              [src]="this.storia.steps[this.currentStepId].backImg" />
      </div>
      <div *ngIf="this.storia.steps[currentStepId].action == 'puzzle'">
        <!-- <app-image-puzzle [puzzleUrl]=steps[currentStepId].puzzleUrl>
        </app-image-puzzle> -->
        <app-image-puzzle
          [difficulty]="this.storia.steps[this.currentStepId].difficulty"
          [puzzleUrl]="this.storia.steps[this.currentStepId].puzzleImg">
        </app-image-puzzle>
      </div> <!-- end PUZZLE -->

      <div *ngIf="this.storia.steps[currentStepId].action == 'dnd'">
        <app-dragndrop [order]="this.storia.steps[this.currentStepId].order"></app-dragndrop>
      </div>

      <div *ngIf="this.storia.steps[currentStepId].action == 'domanda'">
        Ecco la domanda a cui rispondere :
        <b> {{ this.storia.steps[currentStepId].activityTitle }}</b>

        <input
          [(ngModel)]="tempRisposta"
          class="form-control"
          type="text"
          placeholder="Inserisci qui la risposta "
        />
        <button (click)="gestisciAvanzamento()">Avanti</button>
        <img />
      </div>

      <div *ngIf="this.storia.steps[currentStepId].action == 'informazione'">
        step corrente {{ this.currentStepId }}

        <b> {{ this.storia.steps[currentStepId].activityTitle }}</b>
        <button (click)="gestisciAvanzamento()">Avanti</button>
      </div>

      <div *ngIf="this.storia.steps[currentStepId].action == 'fine'" >
        step corrente {{ this.currentStepId }}

        <b> {{ this.storia.steps[currentStepId].activityTitle }}</b>
        <button (click)="fine()">Visualizza classifica</button>
      </div>




      <p> Punteggio : {{this.punteggio }}</p>

    </div>
  </section>
</section>
